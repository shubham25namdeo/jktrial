
import static groovy.json.JsonOutput.*
import groovy.transform.Field

public static final String PROD_MGMT_IP = "192.168.20.1"
def map = [
    foo: 'bar',
    bar: 'foo'
]

@NonCPS
def entries(m) {
    m.collect {k, v -> [k, v]}
}

def builders = [:]
for (def e in entries(map)) {
    echo e.key
    echo e.value
}


node {
  datas = readYaml file: 'release.yml'
  // Git checkout before load source the file
    checkout scm

        def rootDir = pwd()
    println("Current Directory: " + rootDir)

    // point to exact source file
    def example = load "${rootDir}\\Example.Groovy"

    example.exampleMethod()
    example.otherExampleMethod()
}
pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                echo 'Building..'
                echo "Got version as ${datas.version} "
                generate_data(PROD_MGMT_IP)
            }
        }
        stage('Test') {
            steps {
                 parallel (
            "Windows" : {
                echo 'done'
            },
            "Linux" : {
                echo 'done'
            }
        )
            }
        }
        stage {
    parallel builders
}

        stage('Deploy') {
            steps {
                echo 'Deploying....'
            }
        }
    }
}


def generate_data(prod) {
    print(prod)
    }
