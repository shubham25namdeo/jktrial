
import static groovy.json.JsonOutput.*
import groovy.transform.Field

public static final String PROD_MGMT_IP = "192.168.20.1"



node {
  datas = readYaml file: 'release.yml'
  // Git checkout before load source the file
    checkout scm

        def rootDir = pwd()
    println("Current Directory: " + rootDir)

    // point to exact source file
    def example = load "${rootDir}\\Example.Groovy"

    example.exampleMethod()
    example.otherExampleMethod()

}
pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                echo 'Building..'
                echo "Got version as ${datas.version} "
                generate_data(PROD_MGMT_IP)
            }
        }
        stage('Test') {
            steps {
            step(def branches = [:] 
            for (int i = 0; i < 2; i++) {
            def index = i
          
            branches["${index}"] = {
                echo 'done'
                }
             }
             parallel branches)
                 parallel (
            "Windows" : {
                echo 'done'
            },
            "Linux" : {
                echo 'done'
            }
        )
        
            }
        }
        
        stage('Deploy') {
            steps {
                echo 'Deploying....'
            }
        }
    }
}


def generate_data(prod) {
    print(prod)
    }
